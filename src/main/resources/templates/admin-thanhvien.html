<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Admin Member</title>
    <!-- Font Awesome -->
    <link th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css}" rel="stylesheet" />
    <!-- Google Fonts -->
    <link th:href="@{https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap}" rel="stylesheet" />
    <!-- MDB -->
    <link th:href="@{https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.2.0/mdb.min.css}" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!--  CSS -->
    <link th:href="@{/css/style.css}" rel="stylesheet" />
</head>

<body>
<div>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-body-tertiary">
        <!-- Container wrapper -->
        <div class="container-fluid">
            <!-- Toggle button -->
            <button data-mdb-collapse-init class="navbar-toggler" type="button"
                    data-mdb-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>

            <!-- Collapsible wrapper -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <!-- Navbar brand -->
                <a class="navbar-brand mt-2 mt-lg-0" href="#">
                    <img src="https://mdbcdn.b-cdn.net/img/logo/mdb-transaprent-noshadows.webp" height="15"
                         alt="MDB Logo" loading="lazy" />
                </a>
                <!-- Left links -->
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{admin}" href="#">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" th:href="@{admin-thanhvien}">Thành viên</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" th:href="@{admin-thietbi}">Thiết bị</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" th:href="@{admin-vipham}">Vi phạm</a>
                    </li>
                </ul>
                <!-- Left links -->
            </div>
            <!-- Collapsible wrapper -->

            <!-- Right elements -->
            <div class="d-flex align-items-center">
                <!-- Avatar -->
                <div class="dropdown">
                    <a data-mdb-dropdown-init class="dropdown-toggle d-flex align-items-center hidden-arrow"
                       href="#" id="navbarDropdownMenuAvatar" role="button" aria-expanded="false">
                        <img src="https://mdbcdn.b-cdn.net/img/new/avatars/2.webp" class="rounded-circle"
                             height="25" alt="Black and White Portrait of a Man" loading="lazy" />
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuAvatar">
                        <li>
                            <a class="dropdown-item" href="#">My profile</a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="#">Settings</a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="#">Logout</a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- Right elements -->
        </div>
        <!-- Container wrapper -->
    </nav>
    <!-- Navbar -->
</div>
<div class="container">
    <h2 class="text-uppercase text-center mt-5 mb-5">Quản lý thành viên</h2>

    <div class="row mb-3">
        <div class="col-4">
            <div class="form-outline" data-mdb-input-init>
                <input type="text" id="vaoKVHT" class="form-control" />
                <label class="form-label" for="vaoKVHT">Vào khu vực học tập</label>
            </div>
        </div>
    </div>

    <!--    Search and Add Btn -->
    <div class="row">
        <div class="col-md-4">
            <div class="input-group" style="flex-wrap: nowrap">
                <!-- Search input -->
                <div class="form-outline" data-mdb-input-init>
                    <input type="search" id="search" class="form-control" />
                    <label class="form-label" for="search">Search</label>
                </div>
                <!-- Search input -->

                <!--                Btn search -->
                <button type="button" id="searchBtn" class="btn btn-primary" data-mdb-ripple-init>
                    <i class="fas fa-search"></i>
                </button>
                <!--                Btn search -->
            </div>
        </div>
        <div class="col-md-4">
            <button type="button" class="btn-newUser btn btn-outline-primary" data-mdb-ripple-init
                    data-mdb-ripple-color="dark">
                Thêm
            </button>
        </div>
    </div>
    <!--    Search and Add Btn -->

    <!-- search by year -->
    <div class="row my-3">
        <div class="col-md-4">
            <div class="input-group" style="flex-wrap: nowrap">
                <!-- Search by year input -->
                <div class="form-outline" data-mdb-input-init>
                    <input type="search" id="searchByYear" class="form-control" />
                    <label class="form-label" for="searchByYear">Search by year</label>
                </div>
                <!-- Search by year input -->

                <!--                Btn search by year  -->
                <button type="button" id="searchByYearBtn" class="btn btn-primary" data-mdb-ripple-init>
                    <i class="fas fa-search"></i>
                </button>
                <!--                Btn search by year -->
            </div>
        </div>

        <div class="col-md-4">
            <button id="deleteAllButton" type="button" class="btn btn-outline-primary me-2" data-mdb-ripple-init
                    data-mdb-ripple-color="dark">
                Xóa tất cả
            </button>
        </div>
    </div>
    <!-- search by year -->
    <!--    Upload file -->
    <div class="row my-3">
        <div class="col-4">
            <form id="uploadForm" class="input-group">
                <input class="form-control" id="excelBtn" type="file" name="excelBtn" accept=".xls,.xlsx" />
                <button class="btn btn-outline-primary" type="button" id="uploadButton">Upload</button>
            </form>
        </div>
    </div>
    <!--    Upload file -->

    <!--            Table -->
    <table class="table table-striped table-hover">
        <thead>
        <tr>
            <th scope="col">Mã</th>
            <th scope="col">Tên</th>
            <th scope="col">Khoa</th>
            <th scope="col">Ngành</th>
            <th scope="col">Số điện thoại</th>
            <th scope="col">Password</th>
            <th scope="col">Email</th>
        </tr>
        </thead>
        <tbody id="memberList">
        <tr th:each="member : ${memberList}">
            <td scope="col" th:text="${member.MaTV}"></td>
            <td scope="col" th:text="${member.hoTen}"></td>
            <td scope="col" th:text="${member.Khoa}"></td>
            <td scope="col" th:text="${member.Nganh}"></td>
            <td scope="col" th:text="${member.sdt}"></td>
            <td scope="col" th:text="${member.password}"></td>
            <td scope="col" th:text="${member.email}"></td>
            <td style="
                display: flex;
                justify-content: center;
                align-items: center;
              ">
                <i style="color: yellow" th:attr="maTV=${member.MaTV}"
                   onclick="warningMember(this.getAttribute('maTV'))"
                   class="warning-btn fa-solid fa-triangle-exclamation fa-2x"></i>
                <i style="color: red" th:attr="maTV=${member.MaTV}"
                   class="delete-btn fas fa-trash-can fa-2x mx-2"></i>
                <i th:attr="maTV=${member.MaTV}" class="edit-btn fas fa-square-pen fa-2x"></i>
                <div style="display: flex; flex-direction: column; margin-left: 15px">
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" id="payBackBtn"
                            data-bs-target="#returnDeviceModal" th:attr="data-maTV=${member.MaTV}"
                            style="color: rgb(35, 222, 60); margin-left: 5px">
                        Trả thiết bị
                    </button>
                    <!-- Modal -->
                    <div class="modal fade" id="returnDeviceModal" tabindex="-1"
                         aria-labelledby="returnDeviceModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-lg" id="showReturnDevice">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="returnDeviceModalLabel">
                                        Trả thiết bị
                                    </h5>
                                    <div class="mt-3 px-5">
                                        <div class="input-group mb-3">
                                            <label class="input-group-text" for="enterFromDate">Thời gian trả</label>
                                            <input id="enterFromDate" class="form-control" type="datetime-local" min="" />
                                        </div>
                                    </div>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="input-group">
                                                <!-- Search input -->
                                                <div class="form-outline" data-mdb-input-init>
                                                    <input type="search" id="searchReturnDevice"
                                                           class="form-control" />
                                                    <label class="form-label" for="search">Search</label>
                                                </div>
                                                <!-- Search input -->

                                                <!-- Btn search -->
                                                <button type="button" id="searchReturnDeviceBtn"
                                                        class="btn btn-primary" data-mdb-ripple-init>
                                                    <i class="fas fa-search"></i>
                                                </button>
                                                <!-- Btn search -->
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <button type="button" class="btn-newUser btn btn-outline-primary"
                                                    data-mdb-ripple-init data-mdb-ripple-color="dark">
                                                Refresh
                                            </button>
                                        </div>
                                    </div>

                                    <div class="card col-lg-4 col-md-6" style="
                            height: 393px;
                            overflow-y: scroll;
                            scrollbar-width: none;
                            scroll-margin: 1px;
                            width: 100%;
                          ">
                                        <div class="h-100">
                                            <table class="table align-items-center mb-0">
                                                <thead>
                                                <tr>
                                                    <th
                                                            class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                                        Mã thiết bị
                                                    </th>
                                                    <th
                                                            class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">
                                                        Tên
                                                    </th>
                                                    <th
                                                            class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                                        Mô tả
                                                    </th>
                                                    <th
                                                            class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                                        Ngày mượn
                                                    </th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr>
                                                    <td class="align-middle text-left text-sm">
                                                        <input class="form-check-input" type="checkbox"
                                                               value="" id="flexCheckDefault" />
                                                        <label class="form-check-label"
                                                               for="flexCheckDefault">01</label>
                                                    </td>
                                                    <td class="align-middle text-center text-sm">
                                                        Thiết bị A
                                                    </td>
                                                    <td class="align-middle text-center text-sm">
                                                        Được làm băng nhôm
                                                    </td>
                                                    <td class="align-middle text-center text-sm">
                                                        30-2-1119
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" id="save-return-device-btn">
                                        Lưu
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <span class="center" th:attr="data-maTV=${member.MaTV}"
                          onclick="openBorrowDevice(this.getAttribute('data-maTV'))"
                          style="color: rgb(152, 18, 18); margin-left: 5px">Mượn thiết bị</span>
                    <!-- Mượn thiết bị -->
                    <div id="borrowDevice" style="
                    height: 100%;
                    width: 100%;
                    background-color: rgba(189, 189, 189, 0.538);
                    position: fixed;
                    top: 0;
                    display: none;
                    z-index: 2;
                    right:0;
                  ">
                        <div style="
                      position: absolute;
                      height: 566px;
                      width: 600px;
                      background-color: white;
                      top: 12%;
                      right: 50%;
                      transform: translate(50%, 0%);
                      padding: 3px;
                    " class="rounded">
                            <span class="text-uppercase text-center mt-5 mb-5">Mượn thiết bị</span>
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <!-- Search input -->
                                        <div class="form-outline" data-mdb-input-init>
                                            <input type="search" id="searchBorrowDevice" class="form-control" />
                                            <label class="form-label" for="search">Search</label>
                                        </div>
                                        <!-- Search input -->

                                        <!--                Btn search -->
                                        <button type="button" id="searchBorrowDeviceBtn" class="btn btn-primary"
                                                data-mdb-ripple-init>
                                            <i class="fas fa-search"></i>
                                        </button>
                                        <!--                Btn search -->
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <button type="button" class="btn-newUser btn btn-outline-primary"
                                            data-mdb-ripple-init data-mdb-ripple-color="dark">
                                        Refresh
                                    </button>
                                </div>
                                <div class="col-lg-5" style="margin-top: 10px">
                                    <div class="input-group mb-3">
                                        <label class="input-group-text" for="borrowDate">Ngày trả</label>
                                        <input class="form-control" type="date" min="" />
                                    </div>
                                </div>
                            </div>

                            <div class="card col-lg-4 col-md-6" style="
                        height: 393px;
                        overflow-y: scroll;
                        scrollbar-width: none;
                        scroll-margin: 1px;
                        width: 100%;
                      ">
                                <div class="h-100">
                                    <table class="table align-items-center mb-0">
                                        <thead>
                                        <tr>
                                            <th
                                                    class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                                Mã thiết bị
                                            </th>
                                            <th
                                                    class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">
                                                Tên
                                            </th>
                                            <th
                                                    class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                                Mô tả
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td class="align-middle text-left text-sm">
                                                <input class="form-check-input" type="checkbox" value=""
                                                       id="flexCheckDefault" />
                                                <label class="form-check-label"
                                                       for="flexCheckDefault">01</label>
                                            </td>
                                            <td class="align-middle text-center text-sm">
                                                Thiết bị A
                                            </td>
                                            <td class="align-middle text-center text-sm">
                                                Được làm băng nhôm
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div style="
                        display: flex;
                        justify-content: right;
                        margin-top: 5px;
                      ">
                                <button type="button" class="closeBorrowDevice-btn btn btn-link"
                                        data-mdb-ripple-init data-mdb-ripple-color="dark">
                                    Hủy
                                </button>
                                <button type="button" class="btn btn-primary" id="borrow-device-btn"
                                        data-mdb-ripple-init>
                                    Lưu
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Button trigger modal -->
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                            th:attr="data-bs-target=${'#orderDeviceModal_' + member.MaTV}, data-maTV=${member.MaTV}"
                            style="color: rgb(35, 222, 60); margin-left: 5px"
                            onclick="fetchBookedDevices(this.getAttribute('data-maTV'))">
                        Đặt thiết bị
                    </button>
                    <!-- Modal -->
                    <div class="modal fade" th:id="${'orderDeviceModal_' + member.MaTV}" tabindex="-1"
                         aria-labelledby="orderDeviceModalLabel" aria-hidden="true">
                        <script>
                            function fetchBookedDevices(maTV) {
                                fetch("/fetchBookedDevices", {
                                    method: "POST",
                                    headers: {
                                        "Content-Type": "application/json",
                                    },
                                    body: JSON.stringify({ maTV: maTV }),
                                })
                                    .then((res) => res.json())
                                    .then((data) => {
                                        console.log(data);
                                        let modalBody = document.querySelector(".modal-body");
                                        modalBody.innerHTML = ""; // Clear the modal body

                                        let cardDiv = document.createElement("div");
                                        cardDiv.className = "card col-lg-4 col-md-6";
                                        cardDiv.style =
                                            "height: 393px; overflow-y: scroll; scrollbar-width: none; scroll-margin: 1px; width: 100%;";

                                        let table = document.createElement("table");
                                        table.className = "table align-items-center mb-0";

                                        let thead = document.createElement("thead");
                                        thead.innerHTML = `
  <tr>
    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Mã thiết bị</th>
    <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Tên</th>
    <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Mô tả</th>
  </tr>
`;

                                        let tbody = document.createElement("tbody");

                                        data.forEach((device) => {
                                            let tr = document.createElement("tr");
                                            tr.innerHTML = `
    <td class="align-middle text-left text-sm">
      <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault1" />
      <label class="form-check-label" for="flexCheckDefault1">${device.maTB}</label>
    </td>
    <td class="align-middle text-center text-sm">${device.tenTB}</td>
    <td class="align-middle text-center text-sm">${device.moTa}</td>
    <td class="align-middle text-center text-sm">${device.ngayDat}</td>
  `;
                                            tbody.appendChild(tr);
                                        });

                                        table.appendChild(thead);
                                        table.appendChild(tbody);
                                        cardDiv.appendChild(table);
                                        modalBody.appendChild(cardDiv);
                                    });
                            }
                        </script>
                    </div>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
    <!--Table-->
</div>

<!-- new user -->
<div class="newUser" style="
        height: 100%;
        width: 100%;
        background-color: rgba(189, 189, 189, 0.538);
        position: fixed;
        top: 0;
        display: none;
      ">
    <div style="
          position: absolute;
          background-color: white;
          top: 20%;
          right: 50%;
          transform: translate(50%, 0%);
          padding: 3px;
        " class="rounded p-3">
        <span class="text-uppercase text-center mt-5 mb-5">Thành viên mới</span>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon">Mã thành viên</span>
            <input type="text" class="id form-control" aria-label="Username" aria-describedby="basic-addon1" />
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">Tên thành viên</span>
            <input type="text" class="name form-control" aria-label="Username" aria-describedby="basic-addon1" />
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon2">Khoa</span>
            <input type="text" class="khoa form-control" aria-label="Username" aria-describedby="basic-addon1" />
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon3">Ngành</span>
            <input type="text" class="nganh form-control" aria-label="Username" aria-describedby="basic-addon1" />
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon4">Số điện thoại</span>
            <input type="text" class="phone form-control" aria-label="Username" aria-describedby="basic-addon1" />
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon5">Mật khẩu</span>
            <input type="text" class="password form-control" aria-label="Username"
                   aria-describedby="basic-addon1" />
        </div>

        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon6">Email</span>
            <input type="text" class="email form-control" placeholder="Recipient's username"
                   aria-label="Recipient's username" aria-describedby="basic-addon2" />
            <span class="input-group-text" id="basic-addon7">@gmail.com</span>
        </div>

        <div style="display: flex; justify-content: right">
            <button type="button" class="closeNewUser-btn btn btn-link" data-mdb-ripple-init
                    data-mdb-ripple-color="dark">
                Hủy
            </button>
            <button type="button" class="btn btn-primary" data-mdb-ripple-init>
                Lưu
            </button>
        </div>
    </div>
</div>
<!-- update user -->
<div class="updateUser" style="
        height: 100%;
        width: 100%;
        background-color: rgba(189, 189, 189, 0.538);
        position: fixed;
        top: 0;
        display: none;
      ">
    <div style="
          position: absolute;
          background-color: white;
          top: 20%;
          right: 50%;
          transform: translate(50%, 0%);
          padding: 3px;
        " class="rounded p-3">
        <span class="text-uppercase text-center mt-5 mb-5">Sửa thành viên</span>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon8">Tên thành viên</span>
            <input type="text" class="name form-control" aria-label="Username" aria-describedby="basic-addon1" />
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon9">Khoa</span>
            <input type="text" class="khoa form-control" aria-label="Username" aria-describedby="basic-addon1" />
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon10">Ngành</span>
            <input type="text" class="nganh form-control" aria-label="Username" aria-describedby="basic-addon1" />
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon11">Số điện thoại</span>
            <input type="text" class="phone form-control" aria-label="Username" aria-describedby="basic-addon1" />
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon12">Mật khẩu</span>
            <input type="text" class="password form-control" aria-label="Username"
                   aria-describedby="basic-addon1" />
        </div>

        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon13">Email</span>
            <input type="text" class="email form-control" placeholder="Recipient's username"
                   aria-label="Recipient's username" aria-describedby="basic-addon2" />
            <span class="input-group-text" id="basic-addon14">@gmail.com</span>
        </div>

        <div style="display: flex; justify-content: right">
            <button type="button" class="closeNewUser-btn btn btn-link" data-mdb-ripple-init
                    data-mdb-ripple-color="dark" id="cancelEdit">
                Hủy
            </button>
            <button type="button" class="btn btn-primary" id="saveBtn" data-mdb-ripple-init>
                Lưu
            </button>
        </div>
    </div>
</div>

<!-- Cảnh báo thành viên -->
<div id="warningMember" style="
        height: 100%;
        width: 100%;
        background-color: rgba(189, 189, 189, 0.538);
        position: fixed;
        top: 0;
        display: none;
        z-index: 2;
      ">
    <div style="
          position: absolute;
          height: 247px;
          width: 509px;
          background-color: white;
          top: 22%;
          right: 50%;
          transform: translate(50%, 0%);
          padding: 3px;
        " class="rounded p-3">
        <span class="text-uppercase text-center mt-5 mb-5">Cảnh báo thành viên</span>

        <div>
            <div class="input-group mb-3">
                <span class="input-group-text" id="basic-addon">Thành viên</span>
                <input type="text" class="name form-control" id="nameError" aria-describedby="basic-addon1"
                       disabled />
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text" id="basic-addon">Hình thức xử lý</span>
                <input type="text" class="name form-control" id="errorHandle" aria-describedby="basic-addon1"
                       disabled />
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text" id="basic-addon1">Số tiền</span>
                <input type="text" class="name form-control" id="errorMoney" aria-describedby="basic-addon1"
                       disabled />
            </div>
        </div>
        <div style="display: flex; justify-content: right; margin-top: 5px">
            <button type="button" class="closeWarningMember-btn btn btn-link" data-mdb-ripple-init
                    data-mdb-ripple-color="dark">
                Hủy
            </button>
        </div>
    </div>
</div>
</body>

<script type="text/javascript"></script>
<!-- MDB -->
<script type="text/javascript"
        th:src="@{https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.2.0/mdb.umd.min.js}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

<script>
    let newUser = document.querySelector(".newUser");
    let updateUser = document.querySelector(".updateUser");
    let saveButton = document.querySelector(".newUser .btn-primary");
    let editButtons = document.querySelectorAll(".edit-btn");
    let deleteButtons = document.querySelectorAll(".delete-btn");
    let searchButton = document.getElementById("searchBtn");
    let searchButtonYear = document.getElementById("searchByYearBtn");
    let searchInputYear = document.getElementById("searchByYear");
    let deleteAll = document.getElementById("deleteAllButton");
    let searchInput = document.getElementById("search");
    let warningButton = document.querySelectorAll(".warning-btn");
    let currentMaTVEdit;

    //open form new user
    let newUserBtn = document.querySelector(".btn-newUser");
    newUserBtn.addEventListener("click", function () {
        newUser.style.display = " flex";
        newUser.querySelector(".name").value = "";
        newUser.querySelector(".khoa").value = "";
        newUser.querySelector(".nganh").value = "";
        newUser.querySelector(".phone").value = "";
        newUser.querySelector(".password").value = "";
        newUser.querySelector(".email").value = "";
    });

    //open form borrow device
    function openBorrowDevice(user) {
        var borrowDevice = document.getElementById("borrowDevice");
        borrowDevice.style.display = " flex";
    }
    //close form borrow device
    document
        .querySelector(".closeBorrowDevice-btn")
        .addEventListener("click", function () {
            var borrowDevice = document.getElementById("borrowDevice");
            borrowDevice.style.display = " none";
        });

    // Close form order device
    document.querySelector(".btn-close").addEventListener("click", function () {
        if (orderDeviceModalElement) {
            orderDeviceModal.hide();
        } else {
            console.log("No element found with id:", "orderDeviceModal");
        }
    });

    function warningMember(user) {
        var warningMember = document.getElementById("warningMember");
        fetch("/checkError", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ maTV: user }),
        })
            .then((res) => res.json())
            .then((data) => {
                if (data.success === false) {
                    warningMember.style.display = "none";
                    alert(data.message);
                } else {
                    warningMember.style.display = " flex";
                }
            })
            .catch((error) => {
                console.log("error: " + error);
            });
    }

    //close form warning member
    document
        .querySelector(".closeWarningMember-btn")
        .addEventListener("click", function () {
            var warningMember = document.getElementById("warningMember");
            warningMember.style.display = " none";
        });
    //close form new user
    let closeNewUser = document.querySelector(".closeNewUser-btn");
    closeNewUser.addEventListener("click", function () {
        newUser.style.display = " none";
    });
    // close form edit user
    let cancelEditBtn = document.getElementById("cancelEdit");
    cancelEditBtn.addEventListener("click", function () {
        updateUser.style.display = " none";
    });

    // fetch handle
    searchReload();
    // add member
    saveButton.addEventListener("click", () => {
        let maTV = document.querySelector(".id").value;
        let tenTV = document.querySelector(".name").value;
        let khoa = document.querySelector(".khoa").value;
        let nganh = document.querySelector(".nganh").value;
        let sdt = document.querySelector(".phone").value;
        let password = document.querySelector(".password").value;
        let email = document.querySelector(".email").value;

        let newMemberData = {
            maTV: maTV,
            tenTV: tenTV,
            khoa: khoa,
            nganh: nganh,
            sdt: sdt,
            password: password,
            email: email,
        };

        fetch("/addMember", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(newMemberData),
        })
            .then((res) => res.json())
            .then((data) => {
                alert(data.message);
                if (data.success === true) {
                    window.location.reload();
                }
            })
            .catch((error) => {
                console.log("error: " + error);
            });
    });

    // edit member
    let saveBtn = document.getElementById("saveBtn");

    saveBtn.addEventListener("click", () => {
        let maTV = currentMaTVEdit;
        let tenTV = document.querySelector(".updateUser .name").value;
        let khoa = document.querySelector(".updateUser .khoa").value;
        let nganh = document.querySelector(".updateUser .nganh").value;
        let sdt = document.querySelector(".updateUser .phone").value;
        let password = document.querySelector(".updateUser .password").value;
        let email = document.querySelector(".updateUser .email").value;

        let data = {
            maTV: maTV,
            tenTV: tenTV,
            khoa: khoa,
            nganh: nganh,
            sdt: sdt,
            password: password,
            email: email,
        };
        fetch("/editMember", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
        })
            .then((response) => response.json())
            .then((data) => {
                alert(data.message);
                if (data.success === true) {
                    window.location.reload();
                }
            })
            .catch((error) => {
                console.error("Fetch error:", error);
            });
    });

    // search device
    searchButton.addEventListener("click", function () {
        let searchValue = searchInput.value;

        let searchData = {
            searchValue: searchValue,
        };
        fetch("/searchMember", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(searchData),
        })
            .then((res) => res.json())
            .then((data) => {
                document.getElementById("memberList").innerHTML = "";
                data.forEach(function (member) {
                    let tr = document.createElement("tr");
                    tr.innerHTML = innerSearchValue(member);
                    document.getElementById("memberList").appendChild(tr);
                });
                searchReload();
            })
            .catch((error) => {
                console.log("error: " + error);
            });
    });

    // search member(enter)
    searchInput.addEventListener("keydown", function (event) {
        if (event.keyCode === 13) {
            event.stopPropagation();
            let searchValue = searchInput.value;

            let searchData = {
                searchValue: searchValue,
            };
            console.log(JSON.stringify(searchData));
            fetch("/searchMember", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(searchData),
            })
                .then((res) => res.json())
                .then((data) => {
                    document.getElementById("memberList").innerHTML = "";
                    data.forEach(function (member) {
                        let tr = document.createElement("tr");
                        tr.innerHTML = innerSearchValue(member);
                        document.getElementById("memberList").appendChild(tr);
                    });
                    searchReload();
                })
                .catch((error) => {
                    console.log("error: " + error);
                });
        }
    });

    // search by year
    searchButtonYear.addEventListener("click", function () {
        let searchValue = searchInputYear.value;

        let searchData = {
            searchValue: searchValue,
        };

        fetch("/searchMemberByYear", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(searchData),
        })
            .then((res) => res.json())
            .then((data) => {
                document.getElementById("memberList").innerHTML = "";
                data.forEach(function (member) {
                    let tr = document.createElement("tr");
                    tr.innerHTML = innerSearchValue(member);
                    document.getElementById("memberList").appendChild(tr);
                });
                searchReload();
            })
            .catch((error) => {
                console.log("error: " + error);
            });
    });

    // search by year(enter)
    searchInputYear.addEventListener("keydown", function (event) {
        if (event.keyCode === 13) {
            event.preventDefault();

            let searchValue = searchInputYear.value;

            let searchData = {
                searchValue: searchValue,
            };

            fetch("/searchMemberByYear", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(searchData),
            })
                .then((res) => res.json())
                .then((data) => {
                    document.getElementById("memberList").innerHTML = "";
                    data.forEach(function (member) {
                        let tr = document.createElement("tr");
                        tr.innerHTML = innerSearchValue(member);
                        document.getElementById("memberList").appendChild(tr);
                    });
                    searchReload();
                })
                .catch((error) => {
                    console.log("error: " + error);
                });
        }
    });

    deleteAll.addEventListener("click", function () {
        let searchValue = searchInputYear.value;

        let searchData = {
            searchValue: searchValue,
        };
        if (confirm("Bạn có chắc chắn muốn xóa hết?")) {
            fetch("/deleteAll", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(searchData),
            })
                .then((res) => res.json())
                .then((data) => {
                    alert(data.message);
                    if (data.success === true) {
                        window.location.reload();
                    }
                })
                .catch((error) => {
                    console.log("error: " + error);
                });
        }
    });

    var haha = document.querySelectorAll('#payBackBtn');
    haha.forEach((btn) => {
        btn.addEventListener("click",() => {
            console.log(btn.getAttribute("data-matv"));
        })
    })

    function searchReload() {
        let editButtons = document.querySelectorAll(".edit-btn");
        let deleteButtons = document.querySelectorAll(".delete-btn");
        let payBackBtn = document.getElementById("payBackBtn");

        payBackBtn.addEventListener("click", function () {
            let returnDeviceModal = document.getElementById("showReturnDevice");
            console.log(returnDeviceModal);
            returnDeviceModal.style.display = "flex";
        });
        // Close form order device
        document.querySelector(".btn-close").addEventListener("click", function () {
            if (orderDeviceModalElement) {
                orderDeviceModal.hide();
            } else {
                console.log("No element found with id:", "orderDeviceModal");
            }
        });
        //edit user
        editButtons.forEach((btn) => {
            btn.addEventListener("click", function () {
                currentMaTVEdit = btn.getAttribute("maTV");
                fetch("/getMember", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ maTV: btn.getAttribute("maTV") }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        updateUser.style.display = "flex";
                        updateUser.querySelector(".name").value = data.hoTen;
                        updateUser.querySelector(".khoa").value = data.khoa;
                        updateUser.querySelector(".nganh").value = data.nganh;
                        updateUser.querySelector(".phone").value = data.sdt;
                        updateUser.querySelector(".password").value = data.password;
                        updateUser.querySelector(".email").value = data.email;
                    })
                    .catch((error) => console.error("Error:", error));
            });
        });

        // delete device
        deleteButtons.forEach((btn) => {
            btn.addEventListener("click", function () {
                if (confirm("Bạn có chắc chắn muốn xóa thành viên này?")) {
                    let maTV = btn.getAttribute("maTV");

                    fetch("/deleteMember", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ maTV: maTV }),
                    })
                        .then((res) => res.json())
                        .then((data) => {
                            alert(data.message);
                            if (data.success === true) {
                                window.location.reload();
                            }
                        })
                        .catch((error) => {
                            console.log("error: " + error);
                        });
                }
            });
        });

        //warning member
        warningButton.forEach((btn) => {
            btn.addEventListener("click", () => {
                let maTV = btn.getAttribute("maTV");
                fetch("/warningMember", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ maTV: maTV }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.success === true) {
                            document.getElementById("nameError").value = data.data[0].maTV;
                            document.getElementById("errorHandle").value = data.data[0].hinhThucXL;
                            document.getElementById("errorMoney").value = data.data[0].soTien;
                        }
                    })
                    .catch((error) => console.error("Error:", error));
            });
        });
    }

    document
        .getElementById("uploadButton")
        .addEventListener("click", function (event) {
            event.preventDefault();

            var fileInput = document.getElementById("excelBtn");
            var file = fileInput.files[0];
            var formData = new FormData();
            formData.append("excelBtn", file);

            fetch("/uploadExcel", {
                method: "POST",
                body: formData,
            })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success) {
                        alert(data.message);
                    } else {
                        alert(data.message);
                    }
                })
                .catch((error) => console.error("Error:", error));
        });

    $(document).ready(function () {
        $("#orderDeviceForm").on("submit", function (e) {
            e.preventDefault();
            var modal = $(this).closest(".modal.fade");
            var id = modal.attr("id");
            var formData = new FormData(this);
            formData.append("id", id);
            console.log(id);
            $.ajax({
                url: "/orderDevice",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {
                    if (data.success === true) {
                        window.location.reload();
                    }
                },
                error: function (error) {
                    console.error(error);
                },
            });
        });
    });

    function innerSearchValue(member) {
        return `
                    <td>${member.maTV}</td>
                    <td>${member.hoTen}</td>
                    <td>${member.khoa}</td>
                    <td>${member.nganh}</td>
                    <td>${member.sdt}</td>
                    <td>${member.password}</td>
                    <td>${member.email}</td>
                    <td style="display: flex; justify-content: center; align-items: center;">
                        <i style="color: yellow;" maTV="${member.maTV}" onclick="warningMember(this.getAttribute('maTV'))" class="warning-btn fa-solid fa-triangle-exclamation fa-2x"></i>
                        <i style="color: red;" maTV="${member.maTV}" class="delete-btn fas fa-trash-can fa-2x mx-2"></i>
                        <i maTV="${member.maTV}" class="edit-btn fas fa-square-pen fa-2x"></i>
                        <div style="display: flex; flex-direction: column; margin-left: 15px;">
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" id="payBackBtn"
                                data-bs-target="#returnDeviceModal" maTV="${member.maTV}"
                                style="color: rgb(35, 222, 60); margin-left: 5px">
                                Trả thiết bị
                            </button>
                            <div class="modal fade" id="returnDeviceModal" tabindex="-1"
                                aria-labelledby="returnDeviceModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered modal-lg" id="showReturnDevice">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="returnDeviceModalLabel">
                                                Trả thiết bị
                                            </h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col-md-8">
                                                    <div class="input-group">
                                                        <!-- Search input -->
                                                        <div class="form-outline" data-mdb-input-init>
                                                            <input type="search" id="searchReturnDevice"
                                                                class="form-control" />
                                                            <label class="form-label" for="search">Search</label>
                                                        </div>
                                                        <!-- Search input -->

                                                        <!-- Btn search -->
                                                        <button type="button" id="searchReturnDeviceBtn"
                                                            class="btn btn-primary" data-mdb-ripple-init>
                                                            <i class="fas fa-search"></i>
                                                        </button>
                                                        <!-- Btn search -->
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <button type="button" class="btn-newUser btn btn-outline-primary"
                                                        data-mdb-ripple-init data-mdb-ripple-color="dark">
                                                        Refresh
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="card col-lg-4 col-md-6" style="
                            height: 393px;
                            overflow-y: scroll;
                            scrollbar-width: none;
                            scroll-margin: 1px;
                            width: 100%;
                          ">
                                                <div class="h-100">
                                                    <table class="table align-items-center mb-0">
                                                        <thead>
                                                            <tr>
                                                                <th
                                                                    class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                                                    Mã thiết bị
                                                                </th>
                                                                <th
                                                                    class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">
                                                                    Tên
                                                                </th>
                                                                <th
                                                                    class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                                                    Mô tả
                                                                </th>
                                                                <th
                                                                    class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                                                    Ngày mượn
                                                                </th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td class="align-middle text-left text-sm">
                                                                    <input class="form-check-input" type="checkbox"
                                                                        value="" id="flexCheckDefault" />
                                                                    <label class="form-check-label"
                                                                        for="flexCheckDefault">01</label>
                                                                </td>
                                                                <td class="align-middle text-center text-sm">
                                                                    Thiết bị A
                                                                </td>
                                                                <td class="align-middle text-center text-sm">
                                                                    Được làm băng nhôm
                                                                </td>
                                                                <td class="align-middle text-center text-sm">
                                                                    30-2-1119
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-primary" id="save-return-device-btn">
                                                Lưu
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <span class="center" maTV="${member.maTV}" onclick="openBorrowDevice(this.getAttribute('data-maTV'))" style="color: rgb(152, 18, 18); margin-left: 5px;">Mượn thiết bị</span>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                                    th:attr="data-bs-target=${'#orderDeviceModal_' + member.MaTV}, data-maTV=${member.MaTV} maTV="${member.maTV}""
                                                    style="color: rgb(35, 222, 60); margin-left: 5px"
                                                    onclick="fetchBookedDevices(this.getAttribute('data-maTV'))">
                                                    Đặt thiết bị
                                                </button>
                        </div>
                    </td>
                `;
    }

    document.getElementById('vaoKVHT').addEventListener('keydown', function (event) {
        if (event.keyCode === 13) {
            event.preventDefault();
            fetch("/checkIn", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ maTV: document.getElementById('vaoKVHT').value }),
            })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success == false) {
                        alert(data.message);
                    } else {
                        let thanhVien = data.data;
                        alert(
                            `Mã thành viên: ${thanhVien.maTV}\n` +
                            `Họ tên: ${thanhVien.hoTen}\n` +
                            `Khoa: ${thanhVien.khoa}\n` +
                            `Ngành: ${thanhVien.nganh}\n` +
                            `Email: ${thanhVien.email}\n` +
                            `Check-in thành công`
                        );
                    }
                })
                .catch((error) => console.error("Error:", error));
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

</html>